# 专题接口文档

## 获取关注专题列表
> 用户进入关注界面且切换到专题 Tab 时，获取当前已关注的六项专题。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```
budhs: '879646529' // 用户账号
tehsc: 6           // 已获取的专题数
```

#### 后台响应
- 对应视图：view_subject_focus
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "",
    "data": [
        {
            "id": 1,
            "name": "旅游",
            "brief": "“旅”是旅行，外出，即为了实现某一目的而在空间上从甲地到乙地的行进过程；“游”是外出游览、观光、娱乐，即为达到这些目的所作的旅行。二者合起来即旅游。所以，旅行偏重于行，旅游不但有“行”，且有观光、娱乐含义。",
            "thumbnail": "kaiyan/subject/1.jpg",
            "countArticle": 2,
            "countFocus": 127
        }, {
            "id": 2,
            "name": "移动端开发",
            "brief": "移动开发也称为手机开发，或叫做移动互联网开发。是指以手机、PDA、UMPC等便携终端为基础，进行相应的开发工作。",
            "thumbnail": "kaiyan/subject/2.jpg",
            "countArticle": 3,
            "countFocus": 84
        }, {
            "id": 3,
            "name": "前端开发",
            "brief": "扬我大前端！",
            "thumbnail": "kaiyan/subject/3.jpg",
            "countArticle": 2,
            "countFocus": 1041
        }
    ]
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

## 获取专题列表
> 将“发现模块”的获取最新专题、最热门专题，“我的模块”中的获取我的专题结合成一个单独的接口。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```
vhdes: 1           // 检索类型
kvjed: '879646529' // 用户账号
wyejs: 6           // 已获取的专题数 或 已获取专题的最早日期
```
- 请求案例：
```
// vhdes = 1 时
vhdes: 1
wyejs: '2018-03-04 12:14'

// vhdes = 2 时
vhdes:2
wyejs: 6

// vhdes = 3 时
vhdes: 3,
kvjed: '879646529'
```

【说明】：检索类型。
- **vhdes=1**：获取最新专题，注意，此时 wyejs 字段表示已获取专题的最早日期，也就是说前端会传递 2018-03-04 12:14 一个日期。先根据 date 字段 进行降序排列，然后获取 wyejs 日期之前的专题，每次获取 9 条数据。
- **vhdes=2**：获取最热门专题，注意，此时 wyejs 字段表示已获取的专题数，view_subject 已经按照 countFocus 对数据进行降序排列（已经按热门顺序进行排列）。所以后台可以直接用 limit wyejs, 9 的方式进行获取。
- **vhdes=3**：获取我的专题。因为每个用户最多只能有三个专题，因此没有必要对数据进行分批获取，可以直接一次性获取，故而前端就不必传递 wyejs 字段。后台根据前端传递的用户账号，获取该账号对应的专题即可。

#### 后台响应
- 对应视图：view_subject
- 响应内容：

```JS

// 成功响应
{
    "code": "1",
    "msg": "",
    "data": [
        {
            "id": 2,
            "name": "移动端开发",
            "nickname": "游学者、墨槿",
            "thumbnail": "kaiyan/subject/2.jpg",
            "countArticle": 3,
            "countFocus": 84
        }, {
            "id": 3,
            "name": "前端开发",
            "nickname": "游学者、墨槿",
            "thumbnail": "kaiyan/subject/3.jpg",
            "countArticle": 2,
            "countFocus": 1041
        }
    ]
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

## 获取专题详情
> 用户点击感兴趣的专题封面（或专题名称）即可进入到专题详情页面。在该页面会显示有关专题的各项信息，以及该专题下最热门的文章以及最新投稿的文章。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
grbfs: 1            // 专题号
ckege: '879646529'  // 用户账号
```

#### 后台响应
- 对应视图：view_subject
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "",
    "data": {
        "isOwned": false,
        "info": {
            "id": "1",
            "name": "旅游",
            "brief": "“旅”是旅行，外出，即为了实现某一目的而在空间上从甲地到乙地的行进过程；“游”是外出游览、观光、娱乐，即为达到这些目的所作的旅行。二者合起来即旅游。所以，旅行偏重于行，旅游不但有“行”，且有观光、娱乐含义。",
            "thumbnail": "kaiyan/subject/1.jpg",
            "owner": "879646529",
            "nickname": "耗子爱骑车",
            "countArticle": 2,
            "countFocus": 1041
        }
    }
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：后台在获取专题详情的同时，需要判断当前专题是否是用户所拥有的专题。怎么做？先通过专题号获取专题详情，然后判断 owner 与前端传递的用户账号是否匹配。若匹配，则将 isOwned 的值设置为 true；否则，则设置为 false。

### 新建专题
> 用户可以自行创建专题，但每人限创建三个专题。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
ythcs: '879646529'       // 用户账号
utyeh: '前端之路'        // 专题名称
ertqh: '扬我大前端！'    // 专题介绍
oiyhx: 'base64 图片数据' // 专题封面
```

#### 后台响应
- 对应数据表：hsubject
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "新建专题成功！",
    "data": []
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：
- 后台先判断当前用户创建的专题数是否已经到达上限。若达到上限，则返回相应的提示信息给前端；否则，往 hsubject 数据表中插入新的专题信息。
- 需要运用事务进行处理。

【注意】：Ydate 字段插入当前系统时间（时间格式：YYYY-MM-dd HH:mm）。

## 删除专题
> 专题所有者可以删除已拥有的专题。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
rejcs: '1'  // 专题号
```

#### 后台响应
- 有关的数据表：larticle、hsubject、kmesssubject
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "删除专题成功！",
    "data": []
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：
1. 需要将属于该专题文章的 Psid 字段的值设置为 0（表示当前文章尚未投稿）；
2. 给这些文章的用户发送消息，告知其投稿的专题已被删除“XXX专题已被管理员XXX删除”；
3. 从 hsubject 基表中将符合该专题号的专题删除。

【注意】：操作涉及到多条 SQL 语句，因此必须使用事务进行处理。

## 文章投稿
> 用户可以在专题详情页面向该专题投稿。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
ychsw: '879646529180327182534'   // 文章号
hsyce: '1' // 专题号
anscj: '879646529' // 用户账号（发送者账号）
rywjc: '879646528' // 专题管理员账号（接收者账号）
```

#### 后台响应
- 对应数据表：jexamine、umesssubject
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "投稿申请已发送，请等待管理员审核",
    "data": []
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：
- 分别将前端传递的文章号、专题号、用户账号插入到 jexamine 数据表中的 Caid、Usid、Gaccount 等字段，Rid 字段为自增长字段无需插入，Edate 字段取当前系统时间。
- 然后将前端传递的文章号、专题号、发送者账号、接收者账号插入到 umesssubject 数据表中的 Carticle、Isubject、Wsender、Qreceiver 等字段。Did 字段为自增长字段无需插入，Ydaye 字段取当前系统时间。

## 获取未投稿文章
> 用户在投稿前可以先获取自己未投稿的文章。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
hskcu: '879646529'   // 用户账号
```

#### 后台响应
- 对应视图：view_article
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "",
    "data": [
        {
            "title": "浅谈JavaScript中的闭包以及模块机制",
        }, {
           
            "title": "Andorid：这是一份Handler消息传递机制的使用教程",
        }
    ]
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【提示】：根据用户账号和 sid 字段为 0 组合检索（sid 为 0，表示当前文章未投稿）。 

## 获取待审核文章
> 专题管理员能够获取待审核的投稿文章。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
ueysj: '123'   // 专题号
```

#### 后台响应
- 对应视图：view_examine
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "",
    "data": [
        {
            "id": 1,
            "aid": "879646529",
            "title": "浅谈JavaScript中的闭包以及模块机制",
            "nickname": "游学者、墨槿",
            "account": "879646529",
            "head": "kaiyan/head/879646529.jpg",
            "date": "2018-04-21 14:32:14"
        }, {
            "id": 2,
            "aid": "879646529",
            "title": "Andorid：这是一份Handler消息传递机制的使用教程",
            "nickname": "游学者、墨槿",
            "account": "879646529",
            "head": "kaiyan/head/879646529.jpg",
            "date": "2018-04-21 14:35:21"
        }
    ]
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：根据前端传递的专题号，到 view_examine 获取该专题号对应的所有待审核文章。

## 管理待审核文章
> 专题管理员可以管理待审核文章，通过或者拒绝。

#### 前端请求
- 请求地址：
- 请求方式：POST
- 请求参数：

```JS
eshhd: '1'  // 审核号
twrch: '1'  // 管理操作
```
【说明】：管理操作
- **twrch=0**：拒绝该待审核文章。
- **twrch=1**：通过该待审核文章。

#### 后台响应
- 对应数据表：jexamine
- 响应内容：

```JS
// 成功响应
{
    "code": "1",
    "msg": "通过/拒绝XXX待审核文章成功！",
    "data": []
}

// 失败响应
{
    "code": "0",
    "msg": "具体原因",
    "data": []
}
```

【说明】：无论是拒绝还是通过文章，都需要将该审核号对应的数据从 jexamine 数据表中删除。

【步骤】：拒绝
1. 将已拒绝的文章从 jexamine 数据表中删除。
2. 向 smessage 数据表中插入新的数据：Pcontent 可以为 XXX（管理员姓名）拒绝了您的投稿。

【步骤】：通过
1. 修改 larticle 数据表中目前通过文章的 Psid 字段，将字段的值修改为专题号。
2. 将已通过文章的数据从 jexamine 数据表中删除。
3. 向 smessage 数据表中插入新的数据：Pcontent 可以为 XXX（管理员姓名）通过了您的投稿。